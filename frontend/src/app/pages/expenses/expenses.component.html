<div class="space-y-6 animate-fade-in">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold tracking-tight text-foreground">Expenses</h1>
            <p class="text-muted-foreground mt-1">Manage your expenses</p>
        </div>
        <button (click)="openAddModal()" class="btn btn-primary px-4 py-2">
            Add Expense
        </button>
    </div>

    <!-- Filters -->
    <div class="card p-4">
        <div class="flex items-center gap-4">
            <label for="category-filter" class="text-sm font-medium text-foreground">Filter by Category:</label>
            <select id="category-filter" [(ngModel)]="selectedCategoryId" (change)="onFilterChange()"
                class="input max-w-xs">
                <option [ngValue]="null">All Categories</option>
                <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
            </select>
        </div>
    </div>

    <!-- Expense List -->
    <div class="card">
        <div class="divide-y divide-border">
            <div *ngFor="let expense of expenses" class="px-6 py-4 hover:bg-accent/50 transition-colors">
                <div class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-4 flex-1 min-w-0">
                        <div class="h-10 w-10 rounded-full flex items-center justify-center text-white font-semibold text-sm flex-shrink-0"
                            [style.background-color]="expense.categoryColor || 'hsl(var(--muted))'">
                            {{ expense.categoryName?.charAt(0) || '?' }}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-foreground truncate">{{ expense.description }}</p>
                            <p class="text-sm text-muted-foreground">{{ expense.categoryName }}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6 flex-shrink-0">
                        <div class="flex flex-col items-end gap-1">
                            <span class="text-sm font-semibold text-foreground">
                                ${{ expense.amount | number:'1.2-2' }}
                            </span>
                            <span class="text-xs text-muted-foreground">
                                {{ expense.date | date:'mediumDate' }}
                            </span>
                        </div>
                        <div class="flex gap-2">
                            <button (click)="openEditModal(expense)"
                                class="text-sm text-foreground hover:underline underline-offset-4">
                                Edit
                            </button>
                            <button (click)="deleteExpense(expense.id)"
                                class="text-sm text-destructive hover:underline underline-offset-4">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div *ngIf="expenses.length === 0 && !loading" class="px-6 py-12 text-center">
                <p class="text-muted-foreground">No expenses found.</p>
            </div>
            <div *ngIf="loading" class="px-6 py-12 text-center">
                <p class="text-muted-foreground">Loading expenses...</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="fixed z-50 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog"
    aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-black/50 transition-opacity" aria-hidden="true" (click)="closeModal()"></div>

        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

        <div
            class="inline-block align-bottom card text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full p-6">
            <div class="absolute top-4 right-4">
                <button (click)="closeModal()" type="button"
                    class="text-muted-foreground hover:text-foreground transition-colors">
                    <span class="sr-only">Close</span>
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="mt-3">
                <h3 class="text-lg font-semibold text-foreground mb-4" id="modal-title">
                    {{ editingExpense ? 'Edit Expense' : 'Add Expense' }}
                </h3>
                <app-expense-form [expense]="editingExpense" (save)="onSaveExpense($event)" (cancel)="closeModal()">
                </app-expense-form>
            </div>
        </div>
    </div>
</div>